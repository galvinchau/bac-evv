import { Controller, Get, Res } from '@nestjs/common';
import type { Response } from 'express';
import { PDFDocument } from 'pdf-lib';

@Controller('notes')
export class NotesController {
  @Get('export')
  async exportPreview(@Res() res: Response) {
    // Create a simple 1-page A4 PDF as preview
    const pdf = await PDFDocument.create();
    const page = pdf.addPage([595.28, 841.89]); // A4 size in points
    const { height } = page.getSize();

    page.drawText('BAC-EVV — Export Preview', { x: 50, y: height - 80, size: 24 });
    page.drawText('Generated by /notes/export', { x: 50, y: height - 120, size: 14 });
    page.drawText('This is a placeholder PDF. DOCX→PDF pipeline will follow.', {
      x: 50,
      y: height - 150,
      size: 12,
    });

    const bytes = await pdf.save();

    res.setHeader('Content-Type', 'application/pdf');
    res.setHeader('Content-Disposition', 'inline; filename="preview.pdf"');
    return res.send(Buffer.from(bytes));
  }
}
